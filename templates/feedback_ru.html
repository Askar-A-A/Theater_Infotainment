{% extends "base_ru.html" %}
{% load cms_tags %}
{% load static %}

{% block title %}
    Обратная связь - {% placeholder "theater_name" or %}Оперный театр{% endplaceholder %}
{% endblock %}

{% block wrapper_style %}
<style>
    .content-wrapper {
        overflow: hidden;
        height: 400px;
        width: 1280px;
    }
</style>
{% endblock %}

{% block extra_css %}
<style>
    /* Optimized for 1280x400 viewport */
    .feedback-container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4px;
        box-sizing: border-box;
    }

    .feedback-content-box {
        width: 100%;
        max-width: 900px;
        padding: 12px 16px;
        background-color: rgba(0, 0, 0, 0.8);
        border: 2px solid #d4af37;
        border-radius: 8px;
        text-align: center;
        box-sizing: border-box;
    }
    
    /* Compact title */
    .feedback-title {
        color: #d4af37;
        font-size: 1.4rem;
        font-weight: bold;
        margin-bottom: 3px;
        margin-top: 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    /* Compact divider */
    .divider {
        width: 60px;
        height: 2px;
        background-color: #d4af37;
        margin: 0 auto 5px auto;
    }

    /* Compact intro text */
    .feedback-intro {
        color: #ffffff;
        font-size: 0.9rem;
        line-height: 1.2;
        margin-bottom: 8px;
        margin-top: 0;
        max-width: 95%;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Vertical form layout */
    .feedback-form {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        text-align: left;
    }

    /* Form groups */
    .form-group {
        margin-bottom: 6px;
        text-align: left;
    }

    /* Form labels */
    .form-label {
        display: block;
        color: #ffffff;
        font-size: 1rem;
        font-weight: bold;
        margin-bottom: 2px;
        text-align: left;
    }

    /* Form controls */
    .form-control {
        width: 100%;
        background-color: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        color: #ffffff;
        padding: 8px 10px;
        font-size: 1rem;
        box-sizing: border-box;
        min-height: 32px;
    }

    .form-control:focus {
        outline: none;
        background-color: rgba(255, 255, 255, 0.15);
        border-color: #d4af37;
    }

    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }

    /* Textarea */
    textarea.form-control {
        min-height: 60px;
        resize: vertical;
    }

    /* Rating stars */
    .rating-container {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        margin-top: 2px;
        gap: 4px;
    }

    .star {
        color: rgba(255, 255, 255, 0.4);
        cursor: pointer;
        font-size: 1.2rem;
        display: inline-block;
    }

    .star:hover, .star.active {
        color: #ffd700;
    }

    /* Submit button */
    .submit-button {
        display: inline-block;
        padding: 8px 20px;
        font-size: 1rem;
        color: #d4af37;
        background-color: transparent;
        border: 2px solid #d4af37;
        border-radius: 4px;
        text-decoration: none;
        font-weight: bold;
        margin-top: 4px;
        cursor: pointer;
        min-width: 120px;
    }

    .submit-button:hover {
        color: #000000;
        background-color: #d4af37;
    }

    /* Error messages */
    .error-message {
        color: #ff6b6b;
        font-size: 0.8rem;
        margin-top: 2px;
        text-align: left;
    }

    /* Success message */
    .success-message {
        display: none;
        padding: 8px;
        background-color: rgba(0, 150, 0, 0.2);
        border: 2px solid rgba(0, 150, 0, 0.5);
        border-radius: 6px;
        color: #ffffff;
        margin-top: 8px;
        text-align: center;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="feedback-container">
    <div class="feedback-content-box">
        <h1 class="feedback-title">
            {% placeholder "feedback_page_title" or %}Поделитесь своим мнением{% endplaceholder %}
        </h1>
        
        <div class="divider"></div>
        
        <div class="feedback-intro">
            {% placeholder "feedback_page_subtitle" or %}
                Мы ценим ваше мнение и стремимся обеспечить лучший оперный опыт.
                Пожалуйста, поделитесь с нами своими мыслями.
            {% endplaceholder %}
        </div>
        
        <form id="feedbackForm" class="feedback-form" method="post" action="{% url 'user_interactions:process_feedback' %}">
            {% csrf_token %}
            
            <!-- Name field -->
            <div class="form-group">
                <label for="name" class="form-label">Имя</label>
                <input type="text" id="name" name="name" class="form-control" 
                       placeholder="Необязательно" 
                       value="{{ request.session.feedback_data.name|default:'' }}">
                {% if request.session.feedback_errors.name %}
                    <div class="error-message">
                        {{ request.session.feedback_errors.name }}
                    </div>
                {% endif %}
            </div>
            
            <!-- Rating field -->
            <div class="form-group">
                <label class="form-label">Ваша оценка</label>
                <div class="rating-container">
                    <span class="star" data-rating="1">⭐</span>
                    <span class="star" data-rating="2">⭐</span>
                    <span class="star" data-rating="3">⭐</span>
                    <span class="star" data-rating="4">⭐</span>
                    <span class="star" data-rating="5">⭐</span>
                    <input type="hidden" id="rating" name="rating" value="{{ request.session.feedback_data.rating|default:'0' }}">
                </div>
                {% if request.session.feedback_errors.rating %}
                    <div class="error-message">
                        {{ request.session.feedback_errors.rating }}
                    </div>
                {% endif %}
            </div>
            
            <!-- Comments field -->
            <div class="form-group">
                <label for="comments" class="form-label">Ваш отзыв</label>
                <textarea id="comments" name="comments" class="form-control" 
                          placeholder="Пожалуйста, поделитесь своими мыслями, предложениями или впечатлениями...">{{ request.session.feedback_data.comments|default:'' }}</textarea>
                {% if request.session.feedback_errors.comments %}
                    <div class="error-message">
                        {{ request.session.feedback_errors.comments }}
                    </div>
                {% endif %}
            </div>
            
            <!-- Submit button -->
            <button type="submit" class="submit-button">Отправить отзыв</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var stars = document.querySelectorAll('.star');
        var ratingInput = document.getElementById('rating');
        
        if (ratingInput && ratingInput.value > 0) {
            for (var i = 0; i < stars.length; i++) {
                var star = stars[i];
                var starRating = parseInt(star.getAttribute('data-rating'));
                var currentRating = parseInt(ratingInput.value);
                if (starRating <= currentRating) {
                    star.classList.add('active');
                }
            }
        }
        
        for (var j = 0; j < stars.length; j++) {
            stars[j].onclick = function() {
                var rating = this.getAttribute('data-rating');
                ratingInput.value = rating;
                
                for (var k = 0; k < stars.length; k++) {
                    var currentStar = stars[k];
                    var currentStarRating = parseInt(currentStar.getAttribute('data-rating'));
                    var selectedRating = parseInt(rating);
                    
                    if (currentStarRating <= selectedRating) {
                        currentStar.classList.add('active');
                    } else {
                        currentStar.classList.remove('active');
                    }
                }
            };
        }
    });
</script>
{% endblock %}
