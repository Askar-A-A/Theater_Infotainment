{% extends "base.html" %}
{% load cms_tags %}
{% load static %}

{% block title %}
    {% placeholder "today_page_title" or %}Today's Performance - {% placeholder "theater_name" or %}Opera House{% endplaceholder %}{% endplaceholder %}
{% endblock %}

{% block wrapper_style %}
<style>
    /* Enable scrolling for today page */
    .content-wrapper {
        overflow: hidden;
    }
</style>
{% endblock %}

{% block extra_css %}
<style>
    /* Variables for consistent measurements - Optimized for 1024x600 */
    :root {
        --spacing-xs: 0.5rem;
        --spacing-sm: 1rem;
        --spacing-md: 1.5rem;
        --spacing-lg: 2rem;
        --spacing-xl: 3rem;
        
        --border-radius: 10px;
        --border-thin: 1px solid rgba(255,255,255,0.1);
        
        --color-gold: #d4af37;
        --color-bg-dark: rgba(0,0,0,0.7);
        --color-bg-hover: rgba(255,255,255,0.1);
        
        --font-size-sm: 1rem;
        --font-size-md: 1.25rem;
        --font-size-lg: 2.25rem;
        --font-size-xl: 3rem;
    }

    .theater-container {
        width: 100%;
        height: 100%;
        position: relative;
        box-sizing: border-box;
        overflow: hidden;
    }

    /* Setup scroll snapping with enhanced scrollbar - Fixed for 1024x600 */
    .main-content {
        height: 100%;
        width: 100%;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
    }
    
    /* Beautiful gold scrollbar styling - Fixed for 1024x600 */
    .main-content::-webkit-scrollbar {
        width: 10px;
    }

    .main-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
    }

    .main-content::-webkit-scrollbar-thumb {
        background: var(--color-gold);
        border-radius: 5px;
    }

    .main-content::-webkit-scrollbar-thumb:hover {
        background: #b28e29;
    }

    /* Content sections - Fixed for 1024x600 */
    .content-section {
        width: 100%;
        height: 600px;
        padding: 60px 55px 30px 35px;
        scroll-snap-align: start;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
    }
    
    /* Vertical scroll indicators - Fixed for 1024x600 */
    .scroll-indicators {
        position: fixed;
        right: 30px;
        top: 300px;  /* Fixed at 50% of 600px height */
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
        z-index: 100;
    }

    .scroll-dot {
        width: 0.9rem;
        height: 0.9rem;
        border-radius: 50%;
        background: rgba(255,255,255,0.3);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .scroll-dot.active {
        background: var(--color-gold);
        transform: scale(1.2);
    }

    /* Content styling - Fixed for 1024x600 */
    .content-box {
        background: var(--color-bg-dark);
        border: var(--border-thin);
        border-radius: var(--border-radius);
        padding: var(--spacing-lg);
        width: 90%;
        max-width: 1000px;
        max-height: 82vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: auto;
    }
    
    /* Content box scrollbar styling - Fixed for 1024x600 */
    .content-box::-webkit-scrollbar {
        width: 8px;
    }

    .content-box::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
    }

    .content-box::-webkit-scrollbar-thumb {
        background: var(--color-gold);
        border-radius: 4px;
    }

    .content-box::-webkit-scrollbar-thumb:hover {
        background: #b28e29;
    }

    /* Section styling - Fixed for 1024x600 */
    .section-icon {
        color: var(--color-gold);
        font-size: 42px;
        margin-bottom: var(--spacing-md);
    }

    .section-title {
        color: var(--color-gold);
        font-size: 28px;
        margin-bottom: 20px;
        font-family: 'Playfair Display', serif;
        text-align: center;
    }

    /* Production team styling - Fixed for 1024x600 */
    .production-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 22px;
        width: 100%;
    }

    .team-section {
        margin-bottom: var(--spacing-md);
        width: 100%;
    }

    .team-title {
        color: var(--color-gold);
        font-size: 24px;
        margin-bottom: 12px;
        text-align: center;
    }

    .team-content {
        background: rgba(0,0,0,0.3);
        border: var(--border-thin);
        border-radius: var(--border-radius);
        padding: var(--spacing-md);
        color: #fff;
        font-size: 18px;
        line-height: 1.7;
        min-height: 225px;
        height: 100%;
        overflow-y: auto;
    }
    
    /* Team content scrollbar styling - Fixed for 1024x600 */
    .team-content::-webkit-scrollbar {
        width: 6px;
    }

    .team-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
    }

    .team-content::-webkit-scrollbar-thumb {
        background: var(--color-gold);
        border-radius: 3px;
    }

    .team-content::-webkit-scrollbar-thumb:hover {
        background: #b28e29;
    }

    /* Cast styling - Fixed for 1024x600 */
    .cast-member {
        display: flex;
        justify-content: space-between;
        margin-bottom: 9px;
        border-bottom: var(--border-thin);
        padding-bottom: 6px;
    }

    .character {
        color: var(--color-gold);
        font-weight: bold;
        font-size: 1.15em;
    }

    .actor {
        color: #fff;
        text-align: right;
        font-size: 1.15em;
    }

    /* Summary styling - Fixed for 1024x600 */
    .summary-content {
        color: #fff;
        font-size: 18px;
        line-height: 1.7;
        text-align: left;
        margin-bottom: 12px;
        width: 100%;
    }
    
    .summary-content p {
        margin-bottom: 0.8rem;
    }
    
    .summary-content p:last-child {
        margin-bottom: 0;
    }

    /* Responsive adjustments for smaller screens */
    @media screen and (max-width: 768px) {
        .content-box {
            width: 95%;
            padding: var(--spacing-md);
        }
        
        .scroll-indicators {
            right: 10px;
        }
        
        .scroll-dot {
            width: 0.7rem;
            height: 0.7rem;
        }
        
        .production-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .team-content {
            padding: var(--spacing-sm);
            font-size: 17px;
        }
        
        .summary-content {
            font-size: 17px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="theater-container">
    <!-- Vertical Scroll Indicators -->
    <div class="scroll-indicators">
        <div class="scroll-dot active" data-page="0"></div>
        <div class="scroll-dot" data-page="1"></div>
    </div>

    <div class="main-content">
        <!-- Leading Team & Cast Section -->
        <div class="content-section" id="section-0">
            <div class="content-box">
                <i class="fas fa-users section-icon"></i>
                <h2 class="section-title">{% placeholder "team_section_title" or %}Leading Team & Cast{% endplaceholder %}</h2>
                
                <div class="production-grid">
                    <!-- Production Team -->
                    <div class="team-section">
                        <h3 class="team-title">{% placeholder "production_team_title" or %}Production Team{% endplaceholder %}</h3>
                        <div class="team-content">
                            {% placeholder "production_team_content" or %}
                            <p><strong>Conductor:</strong> Riccardo Muti</p>
                            <p><strong>Director:</strong> Franco Zeffirelli</p>
                            <p><strong>Set Design:</strong> Maria Bj√∂rnson</p>
                            <p><strong>Costume Design:</strong> Anthony Powell</p>
                            <p><strong>Lighting Design:</strong> Jennifer Tipton</p>
                            <p><strong>Chorus Master:</strong> Martin Wright</p>
                            {% endplaceholder %}
                        </div>
                    </div>
                    
                    <!-- Cast -->
                    <div class="team-section">
                        <h3 class="team-title">{% placeholder "cast_title" or %}Cast{% endplaceholder %}</h3>
                        <div class="team-content">
                            {% placeholder "cast_content" or %}
                            <p><strong>Floria Tosca:</strong> Anna Netrebko</p>
                            <p><strong>Mario Cavaradossi:</strong> Jonas Kaufmann</p>
                            <p><strong>Baron Scarpia:</strong> Bryn Terfel</p>
                            <p><strong>Cesare Angelotti:</strong> Luca Pisaroni</p>
                            <p><strong>Sacristan:</strong> Alessandro Corbelli</p>
                            <p><strong>Spoletta:</strong> Aled Hall</p>
                            {% endplaceholder %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plot Summary Section -->
        <div class="content-section" id="section-1">
            <div class="content-box">
                <i class="fas fa-book-open section-icon"></i>
                <h2 class="section-title">{% placeholder "synopsis_section_title" or %}Synopsis{% endplaceholder %}</h2>
                
                <div class="summary-content">
                    {% placeholder "synopsis_content" or %}
                    <p>
                        Set in Rome in June 1800, Tosca is a politically charged opera centered around three main characters: 
                        Floria Tosca, a celebrated singer; Mario Cavaradossi, a painter and revolutionary; and Baron Scarpia, 
                        the corrupt Chief of Police.
                    </p>
                    <p>
                        Inside the church of Sant'Andrea della Valle, an escaped political prisoner named Angelotti seeks refuge. 
                        His friend, the painter Cavaradossi, arrives to work on his portrait of Mary Magdalene and promises to help him. 
                        Tosca, Cavaradossi's lover, arrives and becomes jealous when she suspects the woman in the painting is someone 
                        he knows. After she leaves, Cavaradossi and Angelotti hear cannon fire announcing an escaped prisoner, and they flee. 
                        Baron Scarpia arrives searching for Angelotti and finds evidence linking Cavaradossi to him. When Tosca returns, 
                        Scarpia plays on her jealousy to make her reveal Cavaradossi's whereabouts.
                    </p>
                    <p>
                        In his apartment at the Palazzo Farnese, Scarpia anticipates capturing both Angelotti and Cavaradossi. Cavaradossi is 
                        brought in and tortured within Tosca's hearing. Unable to bear his suffering, she reveals Angelotti's hiding place. 
                        Scarpia sentences Cavaradossi to death but offers Tosca a deal: if she gives herself to him, he will spare Cavaradossi. 
                        Tosca reluctantly agrees. After writing a safe-conduct for the couple, Scarpia attempts to embrace Tosca, but she stabs 
                        him to death with a knife from his dinner table.
                    </p>
                    <p>
                        At dawn on the battlements of Castel Sant'Angelo, Cavaradossi awaits execution. Tosca arrives to tell him she has 
                        secured his freedom and that the execution will be a sham, but he must fall as if dead. After the firing squad 
                        departs, Tosca discovers that Scarpia has betrayed her: the execution was real. As Scarpia's men rush in to arrest 
                        her for his murder, Tosca jumps from the battlements to her death.
                    </p>
                    {% endplaceholder %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var mainContent = document.querySelector('.main-content');
        var dots = document.querySelectorAll('.scroll-dot');
        var sections = document.querySelectorAll('.content-section');
        
        // Function to check which section is in view
        function checkCurrentSection() {
            var currentSection = 0;
            var scrollPosition = mainContent.scrollTop;
            
            // Replace forEach with traditional for loop
            for (var i = 0; i < sections.length; i++) {
                var section = sections[i];
                var sectionTop = section.offsetTop;
                var sectionHeight = section.offsetHeight;
                
                if (scrollPosition >= sectionTop - sectionHeight / 3) {
                    currentSection = i;
                }
            }
            
            updateActiveDot(currentSection);
        }
        
        // Update the active dot
        function updateActiveDot(index) {
            // Replace forEach with traditional for loop
            for (var i = 0; i < dots.length; i++) {
                var dot = dots[i];
                if (i === index) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            }
        }
        
        // Scroll to section when dot is clicked
        // Replace forEach with traditional for loop
        for (var i = 0; i < dots.length; i++) {
            var dot = dots[i];
            (function(index) {
                dot.addEventListener('click', function() {
                    sections[index].scrollIntoView({ behavior: 'smooth' });
                });
            })(i);
        }
        
        // Listen for scroll events
        mainContent.addEventListener('scroll', checkCurrentSection);
        
        // Initialize
        checkCurrentSection();
    });
</script>
{% endblock %}
